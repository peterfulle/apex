{% extends 'clients/base_dashboard.html' %}

{% block title %}Dashboard - Aplyfly{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Bienvenido, {{ user.get_full_name }}{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <!-- Total Projects -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-blue-500/10 rounded-lg flex items-center justify-center">
                <i class="fas fa-folder text-blue-400 text-xl"></i>
            </div>
            <span class="text-emerald-400 text-sm font-medium">+12%</span>
        </div>
        <h3 class="text-slate-400 text-sm font-medium mb-1">Total Proyectos</h3>
        <p class="text-3xl font-bold text-slate-100">{{ total_projects }}</p>
    </div>
    
    <!-- Active Projects -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-cyan-500/10 rounded-lg flex items-center justify-center">
                <i class="fas fa-code text-cyan-400 text-xl"></i>
            </div>
            <div class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></div>
        </div>
        <h3 class="text-slate-400 text-sm font-medium mb-1">En Desarrollo</h3>
        <p class="text-3xl font-bold text-slate-100">{{ active_projects }}</p>
    </div>
    
    <!-- Completed Projects -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-emerald-500/10 rounded-lg flex items-center justify-center">
                <i class="fas fa-check-circle text-emerald-400 text-xl"></i>
            </div>
            <i class="fas fa-check text-emerald-400 text-sm"></i>
        </div>
        <h3 class="text-slate-400 text-sm font-medium mb-1">Completados</h3>
        <p class="text-3xl font-bold text-slate-100">{{ completed_projects }}</p>
    </div>
    
    <!-- Pending Requests -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-yellow-500/10 rounded-lg flex items-center justify-center">
                <i class="fas fa-clock text-yellow-400 text-xl"></i>
            </div>
            <span class="text-yellow-400 text-sm font-medium">Pendientes</span>
        </div>
        <h3 class="text-slate-400 text-sm font-medium mb-1">Solicitudes</h3>
        <p class="text-3xl font-bold text-slate-100">{{ pending_requests }}</p>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <!-- New Project -->
    <a href="{% url 'clients:project_create' %}" class="group bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800 hover:border-cyan-500/50 transition-all">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-cyan-500/10 group-hover:bg-cyan-500 rounded-lg flex items-center justify-center transition-colors">
                <i class="fas fa-plus text-cyan-400 group-hover:text-white transition-colors text-xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="text-slate-100 font-semibold mb-1">Nuevo Proyecto</h3>
                <p class="text-slate-400 text-sm">Crear proyecto</p>
            </div>
            <i class="fas fa-arrow-right text-slate-600 group-hover:text-cyan-400 transition-colors"></i>
        </div>
    </a>
    
    <!-- Request Service -->
    <a href="{% url 'clients:service_request_create' %}" class="group bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800 hover:border-emerald-500/50 transition-all">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-emerald-500/10 group-hover:bg-emerald-500 rounded-lg flex items-center justify-center transition-colors">
                <i class="fas fa-concierge-bell text-emerald-400 group-hover:text-white transition-colors text-xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="text-slate-100 font-semibold mb-1">Solicitar Servicio</h3>
                <p class="text-slate-400 text-sm">Pedir cotización</p>
            </div>
            <i class="fas fa-arrow-right text-slate-600 group-hover:text-emerald-400 transition-colors"></i>
        </div>
    </a>
    
    <!-- View Messages -->
    <a href="{% url 'clients:notifications' %}" class="group bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800 hover:border-purple-500/50 transition-all">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 bg-purple-500/10 group-hover:bg-purple-500 rounded-lg flex items-center justify-center transition-colors">
                <i class="fas fa-bell text-purple-400 group-hover:text-white transition-colors text-xl"></i>
            </div>
            <div class="flex-1">
                <h3 class="text-slate-100 font-semibold mb-1">Notificaciones</h3>
                <p class="text-slate-400 text-sm">Ver mensajes</p>
            </div>
            <i class="fas fa-arrow-right text-slate-600 group-hover:text-purple-400 transition-colors"></i>
        </div>
    </a>
</div>

<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Recent Projects -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-slate-100">Proyectos Recientes</h3>
            <a href="{% url 'clients:projects' %}" class="text-cyan-400 hover:text-cyan-300 text-sm font-medium flex items-center gap-2">
                <span>Ver todos</span>
                <i class="fas fa-arrow-right text-xs"></i>
            </a>
        </div>
        
        {% if recent_projects %}
            <div class="space-y-3">
                {% for project in recent_projects %}
                    <div class="bg-slate-800/30 rounded-lg p-4 hover:bg-slate-800/50 transition-colors border border-slate-700/50">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <h4 class="text-slate-100 font-medium mb-1 truncate">{{ project.title }}</h4>
                                <p class="text-slate-400 text-sm mb-3 line-clamp-2">{{ project.description|truncatechars:60 }}</p>
                                <div class="flex items-center gap-3 text-xs">
                                    <span class="px-2.5 py-1 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20">
                                        {{ project.get_status_display }}
                                    </span>
                                    <span class="text-slate-500">
                                        {{ project.created_at|date:"d M Y" }}
                                    </span>
                                </div>
                            </div>
                            <a href="{% url 'clients:project_detail' project.pk %}" class="text-slate-500 hover:text-cyan-400 transition-colors flex-shrink-0">
                                <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-12">
                <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-folder-open text-slate-600 text-2xl"></i>
                </div>
                <p class="text-slate-400 mb-3">No tienes proyectos aún</p>
                <a href="{% url 'clients:project_create' %}" class="inline-flex items-center gap-2 text-cyan-400 hover:text-cyan-300 text-sm font-medium">
                    <i class="fas fa-plus"></i>
                    <span>Crear tu primer proyecto</span>
                </a>
            </div>
        {% endif %}
    </div>
    
    <!-- Recent Service Requests -->
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-slate-100">Solicitudes Recientes</h3>
            <a href="{% url 'clients:service_requests' %}" class="text-cyan-400 hover:text-cyan-300 text-sm font-medium flex items-center gap-2">
                <span>Ver todas</span>
                <i class="fas fa-arrow-right text-xs"></i>
            </a>
        </div>
        
        {% if recent_requests %}
            <div class="space-y-3">
                {% for request in recent_requests %}
                    <div class="bg-slate-800/30 rounded-lg p-4 hover:bg-slate-800/50 transition-colors border border-slate-700/50">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <h4 class="text-slate-100 font-medium mb-1 truncate">{{ request.title }}</h4>
                                <p class="text-slate-400 text-sm mb-3">{{ request.get_service_type_display }}</p>
                                <div class="flex items-center gap-3 text-xs">
                                    <span class="px-2.5 py-1 rounded-full bg-cyan-500/10 text-cyan-400 border border-cyan-500/20">
                                        {{ request.get_status_display }}
                                    </span>
                                    <span class="text-slate-500">
                                        {{ request.created_at|date:"d M Y" }}
                                    </span>
                                </div>
                            </div>
                            <a href="{% url 'clients:service_request_detail' request.pk %}" class="text-slate-500 hover:text-cyan-400 transition-colors flex-shrink-0">
                                <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-12">
                <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-concierge-bell text-slate-600 text-2xl"></i>
                </div>
                <p class="text-slate-400 mb-3">No tienes solicitudes aún</p>
                <a href="{% url 'clients:service_request_create' %}" class="inline-flex items-center gap-2 text-cyan-400 hover:text-cyan-300 text-sm font-medium">
                    <i class="fas fa-plus"></i>
                    <span>Crear tu primera solicitud</span>
                </a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Recent Notifications -->
{% if notifications %}
<div class="mt-8">
    <div class="bg-slate-900/50 backdrop-blur-sm rounded-xl p-6 border border-slate-800">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-semibold text-slate-100 flex items-center gap-2">
                <span>Notificaciones Recientes</span>
                <span class="bg-red-500 text-white text-xs rounded-full px-2 py-0.5">{{ notifications.count }}</span>
            </h3>
            <a href="{% url 'clients:notifications' %}" class="text-cyan-400 hover:text-cyan-300 text-sm font-medium flex items-center gap-2">
                <span>Ver todas</span>
                <i class="fas fa-arrow-right text-xs"></i>
            </a>
        </div>
        
        <div class="space-y-3">
            {% for notification in notifications %}
                <div class="flex items-start gap-4 p-4 bg-slate-800/30 rounded-lg hover:bg-slate-800/50 transition-colors border border-slate-700/50">
                    <div class="w-10 h-10 bg-cyan-500/10 rounded-lg flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-bell text-cyan-400"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-slate-100 font-medium mb-1">{{ notification.title }}</p>
                        <p class="text-slate-400 text-sm mb-2">{{ notification.message|truncatechars:80 }}</p>
                        <p class="text-slate-500 text-xs">{{ notification.created_at|timesince }} atrás</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh dashboard stats every 5 minutes
    setInterval(() => {
        console.log('Verificando actualizaciones del dashboard...');
    }, 300000); // 5 minutes
</script>
{% endblock %}
