<!-- Chat Widget - Bot√≥n flotante y ventana de chat -->
<div id="aplyfly-chat-widget" class="fixed bottom-4 right-4 z-50">
    <!-- Bot√≥n flotante del chat -->
    <div id="chat-toggle-btn" class="group relative">
        <!-- Efecto de onda animada con colores Aplyfly -->
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full animate-ping opacity-20"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-cyan-400 to-purple-500 rounded-full animate-pulse opacity-30"></div>
        
        <!-- Bot√≥n principal con gradiente Aplyfly -->
        <button class="relative w-14 h-14 bg-gradient-to-br from-cyan-500 via-blue-600 to-purple-600 text-white rounded-full shadow-2xl hover:shadow-cyan-500/40 transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-cyan-500/30 group-hover:from-cyan-400 group-hover:via-blue-500 group-hover:to-purple-500">
            <!-- √çcono de chat (visible por defecto) -->
            <i id="chat-icon" class="fas fa-robot text-lg transition-all duration-300"></i>
            <!-- √çcono de cerrar (oculto por defecto) -->
            <i id="close-icon" class="fas fa-times text-lg transition-all duration-300 hidden"></i>
            
            <!-- Indicador de estado activo -->
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full border-2 border-white animate-pulse">
                <div class="w-1 h-1 bg-emerald-600 rounded-full mx-auto mt-0.5"></div>
            </div>
        </button>
        
        <!-- Tooltip mejorado -->
        <div class="absolute right-16 top-1/2 transform -translate-y-1/2 bg-gray-900/95 backdrop-blur-sm text-white px-3 py-2 rounded-xl text-xs font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none whitespace-nowrap shadow-xl border border-gray-700">
            ü§ñ AplyBot - Tu asistente virtual
            <div class="absolute right-0 top-1/2 transform translate-x-1 -translate-y-1/2 w-0 h-0 border-l-6 border-l-gray-900/95 border-t-3 border-t-transparent border-b-3 border-b-transparent"></div>
        </div>
    </div>
    
    <!-- Ventana del chat (estructura limpia y funcional) -->
    <div id="chat-window" class="absolute bottom-16 right-0 w-80 sm:w-[420px] h-[500px] sm:h-[600px] bg-white rounded-2xl sm:rounded-3xl shadow-2xl border border-gray-200/50 transform scale-0 opacity-0 transition-all duration-300 origin-bottom-right backdrop-blur-sm flex flex-col">
        
        <!-- Header FIJO del chat -->
        <div class="bg-gradient-to-r from-cyan-500 via-blue-600 to-purple-600 text-white p-4 sm:p-5 rounded-t-2xl sm:rounded-t-3xl shadow-lg relative flex-shrink-0">
            <!-- L√≠nea superior decorativa -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-300 via-blue-300 to-purple-300"></div>
            
            <div class="flex items-center justify-between relative z-10">
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <!-- Avatar del bot con animaci√≥n -->
                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-2xl flex items-center justify-center backdrop-blur-sm border border-white/40 shadow-lg relative">
                        <span class="text-base sm:text-lg font-bold text-white animate-pulse">&lt;/&gt;</span>
                        <!-- Indicador de estado -->
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full border-2 border-white animate-pulse">
                            <div class="w-1 h-1 bg-emerald-600 rounded-full mx-auto mt-0.5"></div>
                        </div>
                    </div>
                    
                    <div class="flex-1">
                        <h3 class="font-bold text-base sm:text-xl flex items-center text-white drop-shadow-sm">
                            AplyBot
                            <span class="ml-2 text-xs bg-white/25 px-2 py-1 rounded-full border border-white/30 backdrop-blur-sm">IA</span>
                        </h3>
                        <p class="text-xs sm:text-sm text-cyan-100 flex items-center mt-1">
                            <div class="w-2 h-2 bg-emerald-400 rounded-full mr-2 animate-pulse shadow-sm"></div>
                            Asistente Virtual ‚Ä¢ Aplyfly
                        </p>
                    </div>
                </div>
                
                <!-- Botones de control SIEMPRE VISIBLES -->
                <div class="flex items-center space-x-3 relative z-50">
                    <!-- Bot√≥n de informaci√≥n -->
                    <button class="w-10 h-10 bg-white/40 rounded-lg flex items-center justify-center hover:bg-white/60 transition-all duration-200 hover:scale-110 border border-white/50 shadow-md" title="Informaci√≥n">
                        <i class="fas fa-info text-base text-white drop-shadow-sm"></i>
                    </button>
                    
                    <!-- Bot√≥n minimizar -->
                    <button id="minimize-chat" class="w-10 h-10 bg-white/40 rounded-lg flex items-center justify-center hover:bg-white/60 transition-all duration-200 hover:scale-110 border border-white/50 shadow-md" title="Minimizar">
                        <i class="fas fa-times text-base text-white drop-shadow-sm"></i>
                    </button>
                </div>
            </div>
            
            <!-- Indicador de typing mejorado -->
            <div id="typing-indicator" class="mt-3 text-xs sm:text-sm text-cyan-100 opacity-0 transition-all duration-300 flex items-center bg-white/10 rounded-xl px-3 py-2 backdrop-blur-sm">
                <div class="flex space-x-1 mr-3">
                    <div class="w-1.5 h-1.5 bg-cyan-200 rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                    <div class="w-1.5 h-1.5 bg-cyan-200 rounded-full animate-bounce" style="animation-delay: 0.15s;"></div>
                    <div class="w-1.5 h-1.5 bg-cyan-200 rounded-full animate-bounce" style="animation-delay: 0.3s;"></div>
                </div>
                <span class="font-medium">Escribiendo respuesta...</span>
            </div>
        </div>
        
        <!-- Contenido scrolleable del chat -->
        <div class="flex-1 flex flex-col min-h-0">
            <!-- √Årea de mensajes optimizada -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-3 sm:p-4 bg-gradient-to-b from-gray-50 to-white space-y-3 sm:space-y-4">
                <!-- Mensaje de bienvenida compacto -->
                <div class="flex items-start space-x-2 sm:space-x-3 animate-fadeIn">
                    <div class="w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-bold">&lt;/&gt;</span>
                    </div>
                    <div class="bg-white rounded-2xl rounded-tl-lg p-3 sm:p-4 shadow-sm border border-gray-100 max-w-xs">
                        <p class="text-gray-800 text-xs sm:text-sm leading-relaxed">
                            ¬°Hola! üëã Soy <strong>AplyBot</strong> de Aplyfly.
                            <br><br>
                            Te ayudo con info sobre desarrollo web, IA, apps m√≥viles y m√°s.
                            <br><br>
                            ¬øEn qu√© proyecto puedo ayudarte? üöÄ
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- √Årea de input FIJA en la parte inferior -->
            <div class="p-3 sm:p-4 bg-white border-t border-gray-100 rounded-b-2xl sm:rounded-b-3xl flex-shrink-0">
                <!-- Sugerencias r√°pidas compactas -->
                <div id="quick-suggestions" class="mb-2 sm:mb-3 flex flex-wrap gap-1 sm:gap-2">
                    <button class="suggestion-btn text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 rounded-full hover:from-cyan-100 hover:to-blue-100 hover:text-cyan-700 transition-all duration-200 border border-gray-200 hover:border-cyan-300">
                        üíª Web
                    </button>
                    <button class="suggestion-btn text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 rounded-full hover:from-cyan-100 hover:to-blue-100 hover:text-cyan-700 transition-all duration-200 border border-gray-200 hover:border-cyan-300">
                        ü§ñ IA
                    </button>
                    <button class="suggestion-btn text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 rounded-full hover:from-cyan-100 hover:to-blue-100 hover:text-cyan-700 transition-all duration-200 border border-gray-200 hover:border-cyan-300">
                        üì± M√≥vil
                    </button>
                    <button class="suggestion-btn text-xs px-2 py-1 sm:px-3 sm:py-1.5 bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 rounded-full hover:from-cyan-100 hover:to-blue-100 hover:text-cyan-700 transition-all duration-200 border border-gray-200 hover:border-cyan-300">
                        üí∞ Precio
                    </button>
                </div>
                
                <!-- Input de mensaje responsive -->
                <div class="flex items-end space-x-2 sm:space-x-3">
                    <div class="flex-1 relative">
                        <textarea 
                            id="chat-input" 
                            placeholder="Escribe aqu√≠..."
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 pr-10 sm:pr-12 bg-gray-50 border border-gray-200 rounded-xl sm:rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all duration-200 text-xs sm:text-sm"
                            rows="1"
                            maxlength="300"></textarea>
                        
                        <!-- Contador de caracteres compacto -->
                        <div id="char-counter" class="absolute bottom-1 right-2 text-xs text-gray-400">0/300</div>
                    </div>
                    
                    <!-- Bot√≥n enviar compacto -->
                    <button 
                        id="send-btn" 
                        class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-xl hover:shadow-lg hover:shadow-cyan-500/30 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                        <i class="fas fa-paper-plane text-xs sm:text-sm"></i>
                    </button>
                </div>
                
                <!-- Indicador de carga compacto -->
                <div id="sending-indicator" class="mt-1 sm:mt-2 text-xs text-gray-500 opacity-0 transition-opacity duration-300 flex items-center">
                    <i class="fas fa-spinner animate-spin mr-1 text-xs"></i>
                    Enviando...
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estilos adicionales para el chat -->
<style>
    /* Animaciones personalizadas */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(15px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-15px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes headerGlow {
        0%, 100% { box-shadow: 0 4px 20px rgba(6, 182, 212, 0.3); }
        50% { box-shadow: 0 8px 30px rgba(6, 182, 212, 0.5); }
    }
    
    .animate-fadeIn {
        animation: fadeIn 0.4s ease-out;
    }
    
    .animate-slideInRight {
        animation: slideInRight 0.4s ease-out;
    }
    
    .animate-slideInLeft {
        animation: slideInLeft 0.4s ease-out;
    }
    
    /* Header mejorado con efectos */
    #chat-window .bg-gradient-to-r {
        position: relative;
    }
    
    /* Scroll personalizado */
    #chat-messages::-webkit-scrollbar {
        width: 3px;
    }
    
    #chat-messages::-webkit-scrollbar-track {
        background: transparent;
    }
    
    #chat-messages::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #06b6d4, #3b82f6);
        border-radius: 10px;
    }
    
    #chat-messages::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(to bottom, #0891b2, #2563eb);
    }
    
    /* Estado abierto del chat */
    #chat-window.open {
        transform: scale(1);
        opacity: 1;
    }
    
    /* Efecto typewriter para respuestas del bot */
    .typewriter-text {
        border-right: 1px solid #06b6d4;
        animation: blink 1s infinite;
    }
    
    @keyframes blink {
        0%, 50% { border-color: #06b6d4; }
        51%, 100% { border-color: transparent; }
    }
    
    /* Altura espec√≠fica para escritorio */
    @media (min-width: 641px) {
        #chat-window {
            width: 420px !important;
            height: 600px !important;
            max-height: 80vh !important;
        }
    }
    
    /* Asegurar que el chat window use flexbox correctamente */
    #chat-window {
        display: flex !important;
        flex-direction: column !important;
    }
    
    /* Contenido del chat con overflow visible para el header */
    #chat-window .flex-1.flex.flex-col {
        overflow: visible !important;
        min-height: 0 !important;
        flex: 1 !important;
    }
    
    /* √Årea de mensajes con scroll independiente */
    #chat-messages {
        min-height: 200px !important;
        max-height: none !important;
        overflow-y: auto !important;
        flex: 1 !important;
    }
    
    /* Botones del header siempre visibles y clickeables */
    #chat-window button {
        pointer-events: auto !important;
        position: relative !important;
        z-index: 101 !important;
    }
    
    /* Mejorar visibilidad de botones del header */
    #chat-window button {
        cursor: pointer;
        user-select: none;
    }
    
    #chat-window button:active {
        transform: scale(0.95);
    }
    
    /* Asegurar que los iconos sean visibles */
    #chat-window button i {
        color: white !important;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Efectos especiales para botones del header */
    #chat-window .bg-gradient-to-r button:hover {
        background: rgba(255,255,255,0.5) !important;
        transform: scale(1.1) !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
    }
    
    #chat-window .bg-gradient-to-r button:active {
        transform: scale(0.95) !important;
        background: rgba(255,255,255,0.6) !important;
    }
    
    /* Asegurar √°rea clickeable */
    #minimize-chat {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        position: relative !important;
        z-index: 30 !important;
    }
    
    /* Responsive mejorado para m√≥viles */
    @media (max-width: 640px) {
        #aplyfly-chat-widget {
            bottom: 1rem;
            right: 1rem;
            left: 1rem;
        }
        
        #chat-window {
            position: fixed !important;
            bottom: 5rem !important;
            right: 1rem !important;
            left: 1rem !important;
            width: auto !important;
            height: 400px !important;
            max-height: 70vh !important;
        }
        
        #chat-toggle-btn {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
        }
        
        /* Ajustar mensajes en m√≥vil */
        #chat-messages .max-w-xs {
            max-width: calc(100vw - 8rem);
        }
        
        /* Sugerencias responsivas */
        #quick-suggestions {
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        
        .suggestion-btn {
            flex-shrink: 0;
            font-size: 10px;
        }
    }
    
    @media (max-width: 480px) {
        #chat-window {
            height: 350px !important;
            max-height: 65vh !important;
        }
        
        #chat-messages {
            height: 200px !important;
        }
        
        /* Texto m√°s peque√±o en m√≥viles muy peque√±os */
        #chat-messages .text-xs {
            font-size: 11px;
        }
        
        #chat-messages .text-sm {
            font-size: 12px;
        }
    }
    
    /* Mejoras visuales adicionales */
    .suggestion-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.2);
    }
    
    /* Gradiente animado para el bot√≥n principal */
    #chat-toggle-btn button {
        background: linear-gradient(135deg, #06b6d4, #3b82f6, #8b5cf6);
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
    }
    
    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    /* Mejoras para accesibilidad */
    @media (prefers-reduced-motion: reduce) {
        .animate-ping,
        .animate-pulse,
        .animate-bounce,
        .animate-fadeIn,
        .animate-slideInRight,
        .animate-slideInLeft {
            animation: none;
        }
    }
    
    /* Estados de focus mejorados */
    #chat-input:focus {
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        border-color: #06b6d4;
    }
    
    /* Estilo para mensajes del usuario */
    .user-message {
        background: linear-gradient(135deg, #06b6d4, #3b82f6);
        color: white;
        border-radius: 1.5rem;
        border-bottom-right-radius: 0.5rem;
        padding: 0.75rem 1rem;
        margin-left: auto;
        max-width: 16rem;
        word-wrap: break-word;
    }
    
    /* Estilo para mensajes del bot */
    .bot-message {
        background: white;
        color: #374151;
        border-radius: 1.5rem;
        border-top-left-radius: 0.5rem;
        padding: 0.75rem 1rem;
        margin-right: auto;
        max-width: 16rem;
        word-wrap: break-word;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
</style>

<script>
// Inicializar el chat widget cuando se carga la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    if (typeof AplyflyChatWidget !== 'undefined') {
        new AplyflyChatWidget();
    }
});
</script>
